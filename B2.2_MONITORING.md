# ğŸ“Š B2.2 : Monitoring - Processus de Surveillance

## ğŸ¯ Description du Monitoring Kaikai IoT

### 1. ğŸ“ˆ Monitoring du Pipeline de DonnÃ©es

#### **MÃ©triques Ã  surveiller :**
- **Temps de traitement** : DurÃ©e d'analyse des fichiers CSV
- **Taille des datasets** : Nombre de lignes traitÃ©es par batch
- **Taux de succÃ¨s** : Pourcentage de fichiers traitÃ©s avec succÃ¨s
- **Erreurs de format** : Fichiers CSV corrompus ou mal formatÃ©s
- **Performance mÃ©moire** : Utilisation RAM pendant l'analyse

#### **Outils de monitoring :**
- **Prometheus** : Collecte des mÃ©triques de performance
- **Grafana** : Dashboards visuels temps rÃ©el
- **Logs structurÃ©s** : JSON avec timestamp, niveau, message
- **Health checks** : Endpoint `/health` pour vÃ©rifier l'Ã©tat du service

#### **Indicateurs clÃ©s (KPI) :**
```
- Temps moyen de traitement : < 2 secondes/1000 lignes
- Taux de disponibilitÃ© : > 99%
- Taux d'erreur : < 1%
- DÃ©bit de traitement : > 100k lignes/minute
```

---

### 2. ğŸš¨ Alertes PM2.5 - Seuils OMS

#### **Seuils de surveillance :**
- **Seuil d'information** : PM2.5 > 15 Î¼g/mÂ³ (norme OMS journaliÃ¨re)
- **Seuil d'alerte** : PM2.5 > 35 Î¼g/mÂ³ (pic de pollution)
- **Seuil critique** : PM2.5 > 75 Î¼g/mÂ³ (urgence sanitaire)

#### **SystÃ¨me d'alertes :**
```yaml
Niveau INFO (15-35 Î¼g/mÂ³):
  - Email automatique aux Ã©quipes environnement
  - Notification dashboard en temps rÃ©el
  - Mise Ã  jour status page publique

Niveau WARNING (35-75 Î¼g/mÂ³):
  - SMS aux responsables de zone
  - Notification Slack canal #pollution
  - DÃ©clenchement protocole surveillance renforcÃ©e

Niveau CRITICAL (>75 Î¼g/mÂ³):
  - Appel tÃ©lÃ©phonique automatique 24h/7j
  - Email aux autoritÃ©s sanitaires
  - Activation plan d'urgence pollution
```

#### **Logique d'alerte :**
- **DÃ©clenchement** : 3 mesures consÃ©cutives au-dessus du seuil
- **Temporisation** : Pas plus d'1 alerte/heure par capteur
- **Escalade** : Si pas d'accusÃ© rÃ©ception en 15 minutes
- **DÃ©sactivation** : 3 mesures consÃ©cutives sous le seuil

---

### 3. ğŸ”§ Surveillance DisponibilitÃ© Capteurs

#### **Indicateurs de disponibilitÃ© :**
- **DerniÃ¨re transmission** : Timestamp du dernier envoi de donnÃ©es
- **FrÃ©quence d'envoi** : Nombre de mesures/heure attendues
- **QualitÃ© du signal** : Force du signal IoT/WiFi
- **Niveau batterie** : Pourcentage de charge restante
- **Statut calibration** : Date de derniÃ¨re calibration

#### **DÃ©tection de panne :**
```
Capteur OFFLINE :
  - Aucune donnÃ©e depuis > 30 minutes
  - Envoi alerte technique immÃ©diate
  - Marquage automatique "hors service"

Capteur DÃ‰GRADÃ‰ :
  - DonnÃ©es incohÃ©rentes (valeurs impossibles)
  - FrÃ©quence d'envoi < 50% de la normale
  - Batterie < 20%
  - Signal < 2 barres

Capteur OK :
  - Transmission rÃ©guliÃ¨re toutes les 5 minutes
  - Valeurs dans les plages attendues
  - Batterie > 20%, signal > 2 barres
```

#### **Actions automatiques :**
- **Notification maintenance** : Email Ã©quipe technique
- **Remplacement virtuel** : Estimation par capteurs voisins
- **Planning intervention** : CrÃ©ation ticket SAV automatique
- **Rapport mensuel** : Taux de disponibilitÃ© par zone

---

## ğŸ› ï¸ Architecture de Monitoring Simple

### **Stack technique recommandÃ©e :**
```
ğŸ“Š Collecte donnÃ©es    : Filebeat + Logstash
ğŸ“ˆ MÃ©triques          : Prometheus + Node Exporter  
ğŸ“‹ Visualisation      : Grafana dashboards
ğŸš¨ Alertes            : AlertManager
ğŸ“± Notifications      : Slack WebHooks
â˜ï¸  Infrastructure    : Docker Compose ou Kubernetes
```

### **Dashboards principaux :**
1. **Vue opÃ©rationnelle** : Status global des capteurs (carte)
2. **Vue qualitÃ© air** : Niveaux PM2.5 temps rÃ©el par zone
3. **Vue technique** : Performance pipeline et erreurs
4. **Vue maintenance** : Planning interventions et pannes

### **Automatisation des rÃ©ponses :**
- **Auto-scaling** : Ajout ressources si charge > 80%
- **Auto-healing** : RedÃ©marrage service si health check fail
- **Auto-backup** : Sauvegarde donnÃ©es toutes les 6h
- **Auto-rapport** : GÃ©nÃ©ration rapport hebdomadaire automatique

---

## ğŸ“‹ Exemple de Workflow d'Alerte

```mermaid
Capteur PM2.5 > 35 Î¼g/mÂ³ 
    â†“
Validation (3 mesures consÃ©cutives)
    â†“
DÃ©clenchement alerte WARNING
    â†“
Notification Slack + SMS
    â†“
Si > 75 Î¼g/mÂ³ â†’ Escalade CRITICAL
    â†“
Appel tÃ©lÃ©phonique + Email autoritÃ©s
    â†“
Mise Ã  jour dashboard public
    â†“
DÃ©sactivation quand < 35 Î¼g/mÂ³
```

Cette approche garantit une **surveillance complÃ¨te, rÃ©active et automatisÃ©e** du systÃ¨me IoT Kaikai tout en restant **simple Ã  implÃ©menter et maintenir**.
