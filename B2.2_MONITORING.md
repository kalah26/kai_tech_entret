# 📊 B2.2 : Monitoring - Processus de Surveillance

## 🎯 Description du Monitoring Kaikai IoT

### 1. 📈 Monitoring du Pipeline de Données

#### **Métriques à surveiller :**
- **Temps de traitement** : Durée d'analyse des fichiers CSV
- **Taille des datasets** : Nombre de lignes traitées par batch
- **Taux de succès** : Pourcentage de fichiers traités avec succès
- **Erreurs de format** : Fichiers CSV corrompus ou mal formatés
- **Performance mémoire** : Utilisation RAM pendant l'analyse

#### **Outils de monitoring :**
- **Prometheus** : Collecte des métriques de performance
- **Grafana** : Dashboards visuels temps réel
- **Logs structurés** : JSON avec timestamp, niveau, message
- **Health checks** : Endpoint `/health` pour vérifier l'état du service

#### **Indicateurs clés (KPI) :**
```
- Temps moyen de traitement : < 2 secondes/1000 lignes
- Taux de disponibilité : > 99%
- Taux d'erreur : < 1%
- Débit de traitement : > 100k lignes/minute
```

---

### 2. 🚨 Alertes PM2.5 - Seuils OMS

#### **Seuils de surveillance :**
- **Seuil d'information** : PM2.5 > 15 μg/m³ (norme OMS journalière)
- **Seuil d'alerte** : PM2.5 > 35 μg/m³ (pic de pollution)
- **Seuil critique** : PM2.5 > 75 μg/m³ (urgence sanitaire)

#### **Système d'alertes :**
```yaml
Niveau INFO (15-35 μg/m³):
  - Email automatique aux équipes environnement
  - Notification dashboard en temps réel
  - Mise à jour status page publique

Niveau WARNING (35-75 μg/m³):
  - SMS aux responsables de zone
  - Notification Slack canal #pollution
  - Déclenchement protocole surveillance renforcée

Niveau CRITICAL (>75 μg/m³):
  - Appel téléphonique automatique 24h/7j
  - Email aux autorités sanitaires
  - Activation plan d'urgence pollution
```

#### **Logique d'alerte :**
- **Déclenchement** : 3 mesures consécutives au-dessus du seuil
- **Temporisation** : Pas plus d'1 alerte/heure par capteur
- **Escalade** : Si pas d'accusé réception en 15 minutes
- **Désactivation** : 3 mesures consécutives sous le seuil

---

### 3. 🔧 Surveillance Disponibilité Capteurs

#### **Indicateurs de disponibilité :**
- **Dernière transmission** : Timestamp du dernier envoi de données
- **Fréquence d'envoi** : Nombre de mesures/heure attendues
- **Qualité du signal** : Force du signal IoT/WiFi
- **Niveau batterie** : Pourcentage de charge restante
- **Statut calibration** : Date de dernière calibration

#### **Détection de panne :**
```
Capteur OFFLINE :
  - Aucune donnée depuis > 30 minutes
  - Envoi alerte technique immédiate
  - Marquage automatique "hors service"

Capteur DÉGRADÉ :
  - Données incohérentes (valeurs impossibles)
  - Fréquence d'envoi < 50% de la normale
  - Batterie < 20%
  - Signal < 2 barres

Capteur OK :
  - Transmission régulière toutes les 5 minutes
  - Valeurs dans les plages attendues
  - Batterie > 20%, signal > 2 barres
```

#### **Actions automatiques :**
- **Notification maintenance** : Email équipe technique
- **Remplacement virtuel** : Estimation par capteurs voisins
- **Planning intervention** : Création ticket SAV automatique
- **Rapport mensuel** : Taux de disponibilité par zone

---

## 🛠️ Architecture de Monitoring Simple

### **Stack technique recommandée :**
```
📊 Collecte données    : Filebeat + Logstash
📈 Métriques          : Prometheus + Node Exporter  
📋 Visualisation      : Grafana dashboards
🚨 Alertes            : AlertManager
📱 Notifications      : Slack WebHooks
☁️  Infrastructure    : Docker Compose ou Kubernetes
```

### **Dashboards principaux :**
1. **Vue opérationnelle** : Status global des capteurs (carte)
2. **Vue qualité air** : Niveaux PM2.5 temps réel par zone
3. **Vue technique** : Performance pipeline et erreurs
4. **Vue maintenance** : Planning interventions et pannes

### **Automatisation des réponses :**
- **Auto-scaling** : Ajout ressources si charge > 80%
- **Auto-healing** : Redémarrage service si health check fail
- **Auto-backup** : Sauvegarde données toutes les 6h
- **Auto-rapport** : Génération rapport hebdomadaire automatique

---

## 📋 Exemple de Workflow d'Alerte

```mermaid
Capteur PM2.5 > 35 μg/m³ 
    ↓
Validation (3 mesures consécutives)
    ↓
Déclenchement alerte WARNING
    ↓
Notification Slack + SMS
    ↓
Si > 75 μg/m³ → Escalade CRITICAL
    ↓
Appel téléphonique + Email autorités
    ↓
Mise à jour dashboard public
    ↓
Désactivation quand < 35 μg/m³
```

Cette approche garantit une **surveillance complète, réactive et automatisée** du système IoT Kaikai tout en restant **simple à implémenter et maintenir**.
